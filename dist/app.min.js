var EqcApp=angular.module("EqcApp",["ui.router"]);EqcApp.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("calculate",{url:"/",controller:"CalculateController",templateUrl:"templates/calculate/calculate.html"})}]),EqcApp.controller("CalculateController",["$scope",function(e){e.latex="1+2+3=34",e.solvefields=[{order:0,type:"editable",leftside:"",rightside:"3\\left(3+4\\right)-\\frac{3}{5}=2n",solution:{result:"true",variables:[{key:"n",solutions:["10.2"]}],combinations:["n=10.2"]},solved:""}]}]),EqcApp.controller("MainController",["$scope",function(e){}]),EqcApp.directive("editablefield",function(){return{restrict:"E",template:"<div class='editable-math'><span class='mfield' id='editablefield'></span></div>",replace:!0,scope:{latex:"="},link:function(e,t,i){var l;e.render=function(){var i=document.createTextNode(e.latex),d=t.find("#editablefield")[0];d.appendChild(i),l=MathQuill.MathField(d),l.latex(e.latex)},e.render()}}}),EqcApp.directive("mathfield",["$interval",function(e){return{restrict:"E",template:'<div>\n<span id="leftside"></span>\n<span id="equalssign"></span>\n<span class="rightside" id="rightside"></span>\n</div>',replace:!0,scope:{field:"=",recreate:"&"},link:function(e,t,i,l){var d,s,a=document.createTextNode(e.field.leftside),o=document.createTextNode("="),r=document.createTextNode(e.field.rightside),n=t.find("#leftside")[0],f=t.find("#equalssign")[0],c=t.find("#rightside")[0];n.appendChild(a),c.appendChild(r);var p=function(){"embedded-editable"===e.field.type?($(n).addClass("embedded"),$(c).addClass("editable")):"editable-editable"===e.field.type?($(n).addClass("editable"),f.appendChild(o),$(f).addClass("embedded"),$(c).addClass("editable")):"editable"===e.field.type?$(c).addClass("editable"):"embedded"===e.field.type?$(c).addClass("embedded"):(o=document.createTextNode("undefined type"),f.appendChild(o),$(f).addClass("editable")),$(t).find("span.editable").each(function(e){var t=MathQuill.MathField(this,{handlers:{enter:function(){d.latex("heei"),d.revert()}}});d="leftside"===$(this).attr("id")?t:d,s="rightside"===$(this).attr("id")?t:s}),$(t).find("span.embedded").each(function(){var e=MathQuill.StaticMath(this);d="leftside"===$(this).attr("id")?e:d,s="rightside"===$(this).attr("id")?e:s})};p();var v=["editable-editable","editable","embedded-editable"];e.$watch("field",function(t,i){i.type!==t.type&&-1!==v.indexOf(t.type)&&("undefined"!=typeof s&&s.revert(),"undefined"!=typeof d&&d.revert(),p()),"undefined"!=typeof s&&s.latex(e.field.rightside),"undefined"!=typeof d&&d.latex(e.field.leftside)},!0)}}}]),EqcApp.directive("solvearea",function(){return{restrict:"E",templateUrl:"templates/math-directives/solvearea.html",scope:{type:"=",solved:"=",solvefields:"="},controller:["$scope",function(e){e.solveinfos=[],this.getType=function(){return e.type},this.setFieldOrder=function(){for(var t=0;t<e.solvefields.length;t++)e.solvefields[t].order=t;e.$apply()},this.createSolvefield=function(t){console.log("createSolvefield"),e.solvefields.length<15&&(e.solvefields.splice(t+1,0,{order:t+1,type:e.solvefields[t].type,leftside:e.solvefields[t].leftside,rightside:e.solvefields[t].rightside,solution:e.solvefields[t].solution,solved:""}),this.setFieldOrder())},this.removeSolvefield=function(t){console.log("removeSfield"),e.solvefields.length>1&&(e.solvefields.splice(t,1),this.setFieldOrder())};var t=this;e.solve=function(e){t.solveExercise(e)},e.$on("solve",function(t,i){e.solve(0),i.resolve()}),this.solveExercise=function(t){if(Logdef.timerStart("solveExercise"),console.log("solving "+t),"solve"===e.type){for(var i="true",l=0;l<e.solvefields.length;l++)if("editable"===e.solvefields[l].type){var d=e.solvefields[l].rightside;console.log(eqc),eqc.Parser.parseEquation(d);var s="";if("false"===s){e.solvefields[l].solved=s,i=s;break}e.solvefields[l].solved=s,i=s}"true"!==e.solved&&(e.solved=i)}else if("check"===e.type){var a=e.solvefields[t].leftside;a+="editable-editable"===e.solvefields[t].type?"=":"",a+=e.solvefields[t].rightside;var s="";e.solvefields[t].solved=s,"true"!==e.solved&&"true"===s?e.solved="true":"true"!==e.solved&&(e.solved=s)}else if("show"===e.type){var a=e.solvefields[t].leftside;a+="editable-editable"===e.solvefields[t].type?"=":"",a+=e.solvefields[t].rightside,console.log("showing "+a);var o=[];o.length>0&&this.replaceFieldsWithSolution(o)}Logdef.timerEnd("solveExercise")},this.replaceFieldsWithSolution=function(t){console.log("",t);for(var i=[],l=[],d=0;d<t.length;d++)i.push({order:d,type:"editable",leftside:"",rightside:t[d].latex,solution:e.solvefields[0].solution,solved:""}),l.push({step:t[d].stepName,formula:t[d].formula});e.solvefields=i,e.solveinfos=l}}]}}),EqcApp.directive("solvefield",["$interval",function(e){return{restrict:"E",templateUrl:"templates/math-directives/solvefield.html",replace:!0,scope:{field:"="},require:"^solvearea",link:function(e,t,i,l){var d,s,a=[{types:"check-solve-show",keys:"Enter",command:"solveExercise",args:1},{types:"solve",keys:"Shift-Enter",command:"createSolvefield",args:1},{types:"solve",keys:"Shift-Backspace",command:"removeSolvefield",args:1}],o=document.createTextNode(e.field.leftside),r=document.createTextNode("="),n=document.createTextNode(e.field.rightside),f=t.find("#leftside")[0],c=t.find("#equalssign")[0],p=t.find("#rightside")[0];f.appendChild(o),p.appendChild(n);var v=function(){"embedded-editable"===e.field.type?(f.className="embedded",p.className="editable"):"editable-editable"===e.field.type?(f.className="editable",c.appendChild(r),c.className="embedded",p.className="editable"):"editable"===e.field.type?p.className="editable":(r=document.createTextNode("undefined type"),c.appendChild(r),c.className="editable");performance.now();Logdef.timerStart("solvefield MathField each"),$(t).find("span.editable").each(function(t){var i=MathQuill.MathField(this,{spaceBehavesLikeTab:!0,capturingKeyEvents:!0,handlers:{captureKeyEvent:function(t){h();for(var i=0;i<a.length;i++)-1!==a[i].types.indexOf(l.getType())&&a[i].keys===t.key&&(console.log("executing command "+a[i].command),t.evt.preventDefault(),l[a[i].command](e.field.order),e.$apply())},afterCaptureKeyEvent:function(){h()}}});d="leftside"===$(this).attr("id")?i:d,s="rightside"===$(this).attr("id")?i:s}),Logdef.timerEnd("solvefield MathField each"),$(t).find("span.embedded").each(function(){var e=MathQuill.StaticMath(this);d="leftside"===$(this).attr("id")?e:d,s="rightside"===$(this).attr("id")?e:s})};v();var h=function(){d&&(e.field.leftside=d.latex()),s&&(e.field.rightside=s.latex())}}}}]);
//# sourceMappingURL=app.min.js.map
