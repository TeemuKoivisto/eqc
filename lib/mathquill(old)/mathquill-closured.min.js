!function(){function C(){}function da(d){var a=d.length-1;return function(){var b=ea.call(arguments,0,a),c=ea.call(arguments,a);return d.apply(this,b.concat([c]))}}function fa(d){return da(function(a,b){"function"!=typeof a&&(a=Ea(a));return d.call(this,function(c){return a.apply(c,[c].concat(b))})})}function e(d){var a=ea.call(arguments,1);return function(){return d.apply(this,a)}}function w(d,a){if(!a)throw Error("prayer failed: "+d);}function H(d){w("a direction was passed",d===f||d===h)}function ga(d,
a,b){w("a parent is always present",d);w("leftward is properly set up",a?a[h]===b&&a.parent===d:d.ends[f]===b);w("rightward is properly set up",b?b[f]===a&&b.parent===d:d.ends[h]===a)}function z(d){return d&&d.nodeType?(d=t(d).children(".mq-root-block").attr(N))?A.byId[d].controller.API:null:null}function ha(d){function a(b,c){var p=z(b);return p instanceof d||!b||!b.nodeType?p:d(t(b),c)}return a.prototype=d.prototype,a}function ra(d){var a,b="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf reflow".split(" ");
for(a=0;a<b.length;a+=1)(function(b){d[b]=function(d){this.controller.handle(b,d)}})(b[a])}function Q(d,a,b){return k(W,{ctrlSeq:d,htmlTemplate:"<"+a+" "+b+">&0</"+a+">"})}function ia(d){var a=this.parent,b=d;do{if(b[h])return d.insLeftOf(a);b=b.parent.parent}while(b!==a);d.insRightOf(a)}function sa(d,a){d.jQadd=function(){a.jQadd.apply(this,arguments);this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last"));this.contentjQ=this.jQ.children(":eq(1)")};d.reflow=function(){var b=this.contentjQ.outerHeight()/
parseFloat(this.contentjQ.css("fontSize"));X(this.delimjQs,ta(1+.2*(b-1),1.2),1.2*b)}}function ja(d,a){a=a||d;var b=S[d],c=S[a];I[d]=e(O,f,d,b,a,c);I[b]=e(O,h,d,b,a,c)}var ua,M,Y,E,m,va,F,ka,u,D,g,n,B,la,W,P,ma,wa,xa,x,J,T,ya,na,r,U,oa,X,pa,qa,y,R,V,za,Aa,O,S,Ba,aa=window.jQuery,N="mathquill-block-id",ta=Math.min,Ca=Math.max,ea=[].slice,Ea=da(function(a,l){return da(function(b,c){return a in b?b[a].apply(b,l.concat(c)):void 0})}),k=function(a,l,b){function c(){}return function ba(v,f){function e(){var b=
new h;return"function"==typeof b.init&&b.init.apply(b,arguments),b}function h(){}var g,q,k;return f===b&&(f=v,v=Object),e.Bare=h,g=c[a]=v[a],q=h[a]=e[a]=e.p=new c,q.constructor=e,e.mixin=function(b){return h[a]=e[a]=ba(e,b)[a],e},(e.open=function(b){if(k={},"function"==typeof b?k=b.call(e,q,g,e,v):"object"==typeof b&&(k=b),"object"==typeof k)for(var c in k)l.call(k,c)&&(q[c]=k[c]);return"function"==typeof q.init||(q.init=v),e})(f)}}("prototype",{}.hasOwnProperty),f=z.L=-1,h=z.R=1,t=k(aa,function(a){a.insDirOf=
function(a,b){return a===f?this.insertBefore(b.first()):this.insertAfter(b.last())};a.insAtDirEnd=function(a,b){return a===f?this.prependTo(b):this.appendTo(b)}}),L=k(function(a){a.parent=0;a[f]=0;a[h]=0;a.init=function(a,b,c){this.parent=a;this[f]=b;this[h]=c};this.copy=function(a){return L(a.parent,a[f],a[h])}}),A=k(function(a){a[f]=0;a[h]=0;var l=a.parent=0;this.byId={};a.init=function(){this.id=l+=1;A.byId[this.id]=this;this.ends={};this.ends[f]=0;this.ends[h]=0};a.dispose=function(){delete A.byId[this.id]};
a.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"};a.jQ=t();a.jQadd=function(b){return this.jQ=this.jQ.add(b)};a.jQize=function(b){function c(b){var a,d;b.getAttribute&&(a=b.getAttribute("mathquill-command-id"),d=b.getAttribute("mathquill-block-id"),a&&A.byId[a].jQadd(b),d&&A.byId[d].jQadd(b));for(b=b.firstChild;b;b=b.nextSibling)c(b)}var a;b=t(b||this.html());for(a=0;a<b.length;a+=1)c(b[a]);return b};a.createDir=function(b,c){H(b);return this.jQize(),this.jQ.insDirOf(b,c.jQ),c[b]=this.adopt(c.parent,
c[f],c[h]),this};a.createLeftOf=function(b){return this.createDir(f,b)};a.selectChildren=function(b,c){return Da(b,c)};a.bubble=fa(function(b){var c,a;for(c=this;c&&(a=b(c),!1!==a);c=c.parent);return this});a.postOrder=fa(function(b){return function p(a){a.eachChild(p);b(a)}(this),this});a.isEmpty=function(){return 0===this.ends[f]&&0===this.ends[h]};a.children=function(){return G(this.ends[f],this.ends[h])};a.eachChild=function(){var b=this.children();return b.each.apply(b,arguments),this};a.foldChildren=
function(b,c){return this.children().fold(b,c)};a.withDirAdopt=function(b,c,a,d){return G(this,this).withDirAdopt(b,c,a,d),this};a.adopt=function(b,c,a){return G(this,this).adopt(b,c,a),this};a.disown=function(){return G(this,this).disown(),this};a.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),G=k(function(a){a.init=function(a,b,c){if(void 0===c&&(c=f),H(c),w("no half-empty fragments",!a==!b),this.ends={},a)w("withDir is passed to Fragment",a instanceof A),w("oppDir is passed to Fragment",
b instanceof A),w("withDir and oppDir have the same parent",a.parent===b.parent),this.ends[c]=a,this.ends[-c]=b,a=this.fold([],function(b,c){return Array.prototype.push.apply(b,c.jQ.get()),b}),this.jQ=this.jQ.add(a)};a.jQ=t();a.withDirAdopt=function(a,b,c,d){return a===f?this.adopt(b,c,d):this.adopt(b,d,c)};a.adopt=function(a,b,c){var d,e;return ga(a,b,c),this.disowned=!1,(d=this.ends[f])?(e=this.ends[h],b||(a.ends[f]=d),c?c[f]=e:a.ends[h]=e,this.ends[h][h]=c,this.each(function(c){c[f]=b;c.parent=
a;b&&(b[h]=c);b=c}),this):this};a.disown=function(){var a,b,c=this.ends[f];return!c||this.disowned?this:(this.disowned=!0,a=this.ends[h],b=c.parent,ga(b,c[f],c),ga(b,a,a[h]),c[f]?c[f][h]=a[h]:b.ends[f]=a[h],a[h]?a[h][f]=c[f]:b.ends[h]=c[f],this)};a.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()};a.each=fa(function(a){var b,c=this.ends[f];if(!c)return this;for(;c!==this.ends[h][h]&&(b=a(c),!1!==b);c=c[h]);return this});a.fold=function(a,b){return this.each(function(c){a=
b.call(this,a,c)}),a}}),a={},I={},Fa=k(L,function(a){a.init=function(a,b){this.parent=a;this.options=b;var c=this.jQ=this._jQ=t('<span class="mq-cursor">&#8203;</span>');this.blink=function(){c.toggleClass("mq-blink")};this.upDownCache={}};a.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[h]?this.selection&&this.selection.ends[f][f]===this[f]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[h].jQ.first()):this.jQ.appendTo(this.parent.jQ),
this.parent.focus()),this.intervalId=setInterval(this.blink,500),this};a.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=t(),this};a.withDirInsertAt=function(a,b,c,d){b!==this.parent&&this.parent.blur&&this.parent.blur();this.parent=b;this[a]=c;this[-a]=d};a.insDirOf=function(a,b){return H(a),this.withDirInsertAt(a,b.parent,b[a],b),this.parent.jQ.addClass("mq-hasCursor"),this.jQ.insDirOf(a,b.jQ),this};a.insLeftOf=function(a){return this.insDirOf(f,
a)};a.insRightOf=function(a){return this.insDirOf(h,a)};a.insAtDirEnd=function(a,b){return H(a),this.withDirInsertAt(a,b,0,b.ends[a]),this.jQ.insAtDirEnd(a,b.jQ),b.focus(),this};a.insAtLeftEnd=function(a){return this.insAtDirEnd(f,a)};a.insAtRightEnd=function(a){return this.insAtDirEnd(h,a)};a.jumpUpDown=function(a,b){var c,d;this.upDownCache[a.id]=L.copy(this);(c=this.upDownCache[b.id])?c[h]?this.insLeftOf(c[h]):this.insAtRightEnd(c.parent):(d=this.offset().left,b.seek(d,this))};a.offset=function(){var a=
this.jQ.removeClass("mq-cursor").offset();return this.jQ.addClass("mq-cursor"),a};a.unwrapGramp=function(){var a=this.parent.parent,b=a.parent,c=a[h],d=a[f];if(a.disown().eachChild(function(f){f.isEmpty()||(f.children().adopt(b,d,c).each(function(b){b.jQ.insertBefore(a.jQ.first())}),d=f.ends[h])}),!this[h])if(this[f])this[h]=this[f][h];else for(;!this[h];){if(this.parent=this.parent[h],!this.parent){this[h]=a[h];this.parent=b;break}this[h]=this.parent.ends[f]}this[h]?this.insLeftOf(this[h]):this.insAtRightEnd(b);
a.jQ.remove();a[f].siblingDeleted&&a[f].siblingDeleted(this.options,h);a[h].siblingDeleted&&a[h].siblingDeleted(this.options,f)};a.startSelection=function(){var a;a=this.anticursor=L.copy(this);for(var b=a.ancestors={};a.parent;a=a.parent)b[a.parent.id]=a};a.endSelection=function(){delete this.anticursor};a.select=function(){var a,b,c,d,e,v,g;v=this.anticursor;if(this[f]===v[f]&&this.parent===v.parent)return!1;for(a=this;a.parent;a=a.parent)if(a.parent.id in v.ancestors){b=a.parent;break}if(w("cursor and anticursor in the same tree",
b),c=v.ancestors[b.id],v=h,a[f]!==c)for(g=a;g;g=g[h])if(g[h]===c[h]){v=f;d=a;e=c;break}return v===h&&(d=c,e=a),d instanceof L&&(d=d[h]),e instanceof L&&(e=e[f]),this.hide().selection=b.selectChildren(d,e),this.insDirOf(v,this.selection.ends[v]),this.selectionChanged(),!0};a.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this};a.deleteSelection=function(){this.selection&&(this[f]=this.selection.ends[f][f],this[h]=this.selection.ends[h][h],
this.selection.remove(),this.selectionChanged(),delete this.selection)};a.replaceSelection=function(){var a=this.selection;return a&&(this[f]=a.ends[f][f],this[h]=a.ends[h][h],delete this.selection),a}}),Da=k(G,function(a,l){a.init=function(){l.init.apply(this,arguments);this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()};a.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),l.adopt.apply(this,arguments)};a.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),
this};a.join=function(b){return this.fold("",function(a,d){return a+d[b]()})}}),K=k(function(a){a.init=function(b,a,d){this.API=b;this.root=a;this.container=d;b.__controller=a.controller=this;this.cursor=a.cursor=Fa(a,b.__options)};a.handle=function(b,a,d){var l=this.API.__options.handlers;if(l&&l[b])if(a===f||a===h)l[b](a,this.API);else if("captureKeyEvent"===b)l[b](d);else l[b](this.API)};var l=[];this.onNotify=function(b){l.push(b)};a.notify=function(){for(var b=0;b<l.length;b+=1)l[b].apply(this.cursor,
arguments);return this}});z.noConflict=function(){return window.MathQuill=ua,z};ua=window.MathQuill;window.MathQuill=z;M=k();Y={};z.__options=M.p;E=k(function(a){a.init=function(){throw"wtf don't call me, I'm 'abstract'";};a.initRoot=function(a,b,c){var d;this.__options=M();this.config(c);K(this,a,b).createTextarea();d=b.contents().detach();a.jQ=t('<span class="mq-root-block"/>').attr(N,a.id).appendTo(b);this.latex(d.text());this.revert=function(){return b.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(d)}};
a.config=z.config=function(a){var b,c,d;for(b in a)a.hasOwnProperty(b)&&(c=a[b],d=Y[b],this.__options[b]=d?d(c):c);return this};a.el=function(){return this.__controller.container[0]};a.text=function(){return this.__controller.exportText()};a.latex=function(a){return 0<arguments.length?(this.__controller.renderLatexMath(a),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()};a.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,
"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")};a.reflow=function(){return this.__controller.root.postOrder("reflow"),this};a.fastClick=function(a,b,c){a=this.__controller;var d=a.root,f=document.elementFromPoint(b,c);aa.contains(d.jQ[0],f)||(f=d.jQ[0]);a.seek(t(f),b+pageXOffset,c+pageYOffset)};a.ignoreNextMousedown=function(a){this.__controller.cursor.options.ignoreNextMousedown=a}});z.prototype=E.prototype;
z.StaticMath=ha(k(E,function(a,l){a.init=function(b){this.initRoot(B(),b.addClass("mq-math-mode"));this.__controller.delegateMouseEvents();this.__controller.staticMathTextareaEvents()};a.latex=function(){var b=l.latex.apply(this,arguments);return 0<arguments.length&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[]),b}}));E=z.EditableField=k(E,function(d){d.initRootAndEvents=function(a,b,c){this.initRoot(a,b,c);this.__controller.editable=!0;this.__controller.delegateMouseEvents();
this.__controller.editablesTextareaEvents()};d.focus=function(){return this.__controller.textarea.focus(),this};d.blur=function(){return this.__controller.textarea.blur(),this};d.write=function(a){return this.__controller.writeLatex(a),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this};d.cmd=function(d){var b,c=this.__controller.notify(),p=c.cursor;return/^\\[a-z]+$/i.test(d)?(d=d.slice(1),b=a[d],b&&(d=b(d),p.selection&&d.replaces(p.replaceSelection()),d.createLeftOf(p.show()))):
p.parent.write(p,d),c.blurred&&p.hide().parent.blur(),this};d.select=function(){var a=this.__controller;for(a.notify("move").cursor.insAtRightEnd(a.root);a.cursor[f];)a.selectLeft();return this};d.clearSelection=function(){return this.__controller.cursor.clearSelection(),this};d.moveToDirEnd=function(a){return this.__controller.notify("move").cursor.insAtDirEnd(a,this.__controller.root),this};d.moveToLeftEnd=function(){return this.moveToDirEnd(f)};d.moveToRightEnd=function(){return this.moveToDirEnd(h)};
d.keystroke=function(a){var b;a=a.replace(/^\s+|\s+$/g,"").split(/\s+/);for(b=0;b<a.length;b+=1)this.__controller.keystroke(a[b],{preventDefault:C});return this};d.typedText=function(a){for(var b=0;b<a.length;b+=1)this.__controller.typedText(a.charAt(b));return this}});m=k(function(a,l,b){function c(b,a){throw b=b?"'"+b+"'":"EOF","Parse Error: "+a+" at "+b;}var p,f;a.init=function(b){this._=b};a.parse=function(b){return this.skip(f)._(""+b,function(b,a){return a},c)};a.or=function(a){w("or is passed a parser",
a instanceof b);var c=this;return b(function(b,d,p){return c._(b,d,function(c){return a._(b,d,p)})})};a.then=function(a){var c=this;return b(function(d,p,l){return c._(d,function(c,d){var f=a instanceof b?a:a(d);return w("a parser is returned",f instanceof b),f._(c,p,l)},l)})};a.many=function(){var a=this;return b(function(b,c,d){function p(a,c){return b=a,f.push(c),!0}function l(){return!1}for(var f=[];a._(b,p,l););return c(b,f)})};a.times=function(a,c){2>arguments.length&&(c=a);var d=this;return b(function(b,
p,l){function f(a,c){return k.push(c),b=a,!0}function e(a,c){return ba=c,b=a,!1}function h(b,a){return!1}var ba,g,k=[],m=!0;for(g=0;a>g;g+=1)if(m=d._(b,f,e),!m)return l(b,ba);for(;c>g&&m;g+=1)m=d._(b,f,h);return p(b,k)})};a.result=function(b){return this.then(p(b))};a.atMost=function(b){return this.times(0,b)};a.atLeast=function(b){var a=this;return a.times(b).then(function(b){return a.many().map(function(a){return b.concat(a)})})};a.map=function(b){return this.then(function(a){return p(b(a))})};
a.skip=function(b){return this.then(function(a){return b.result(a)})};this.string=function(a){var c=a.length,d="expected '"+a+"'";return b(function(b,p,l){var f=b.slice(0,c);return f===a?p(b.slice(c),f):l(b,d)})};a=this.regex=function(a){w("regexp parser is anchored","^"===a.toString().charAt(1));var c="expected "+a;return b(function(b,d,p){var l,f=a.exec(b);return f?(l=f[0],d(b.slice(l.length),l)):p(b,c)})};p=b.succeed=function(a){return b(function(b,c){return c(b,a)})};b.fail=function(a){return b(function(b,
c,d){return d(b,a)})};b.letter=a(/^[a-z]/i);b.letters=a(/^[a-z]*/i);b.digit=a(/^[0-9]/);b.digits=a(/^[0-9]*/);b.whitespace=a(/^\s+/);b.optWhitespace=a(/^\s*/);b.any=b(function(b,a,c){return b?a(b.slice(1),b.charAt(0)):c(b,"expected any character")});b.all=b(function(b,a,c){return a("",b)});f=b.eof=b(function(b,a,c){return b?c(b,"expected EOF"):a(b,b)})});va=function(){function a(b){var c,d=b.which||b.keyCode,f=l[d],e=[];return b.ctrlKey&&e.push("Ctrl"),b.originalEvent&&b.originalEvent.metaKey&&e.push("Meta"),
b.altKey&&e.push("Alt"),b.shiftKey&&e.push("Shift"),c=f||String.fromCharCode(d),e.length||f?(e.push(c),e.join("-")):c}var l={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(b,c){function p(b){n=b;clearTimeout(e);e=setTimeout(b)}function l(){var b=q[0];"selectionStart"in b&&b.selectionStart!==b.selectionEnd||
(b=q.val(),1===b.length?(q.val(""),c.typedText(b)):b&&q[0].select&&q[0].select())}function f(){var b=q.val();q.val("");b&&c.paste(b)}var e,h,g=null,k=null,q=aa(b),m=aa(c.container||q),n=C;return m.bind("keydown keypress input keyup focusout paste",function(){n()}),h=!1,m.bind({keydown:function(b){g=b;k=null;h&&p(function(){q[0].select&&q[0].select();n=C;clearTimeout(e)});c.keystroke(a(g),g)},keypress:function(b){g&&k&&c.keystroke(a(g),g);k=b;p(l)},focusout:function(){g=k=null},paste:function(b){q.focus();
p(f)}}),{select:function(b){n();n=C;clearTimeout(e);q.val(b);b&&q[0].select&&q[0].select();h=!!b}}}}();K.open(function(a,l){a.exportText=function(){return this.root.foldChildren("",function(b,a){return b+a.text()})}});K.open(function(a){a.focusBlurEvents=function(){function a(){clearTimeout(c);e.selection&&e.selection.jQ.addClass("mq-blur");b()}function b(){e.hide().parent.blur();d.container.removeClass("mq-focused");t(window).off("blur",a)}var c,d=this,f=d.root,e=d.cursor;d.textarea.focus(function(){d.blurred=
!1;clearTimeout(c);d.container.addClass("mq-focused");e.parent||e.insAtRightEnd(f);e.selection?(e.selection.jQ.removeClass("mq-blur"),d.selectionChanged()):e.show()}).blur(function(){d.blurred=!0;c=setTimeout(function(){f.postOrder("intentionalBlur");e.clearSelection();b()});t(window).on("blur",a)});d.blurred=!0;e.hide().parent.blur()}});K.open(function(a){a.keystroke=function(a,b){this.API.__options.capturingKeyEvents&&this.handle("captureKeyEvent","",{key:a,evt:b});this.cursor.parent.keystroke(a,
b,this)}});A.open(function(a){a.keystroke=function(a,b,c){var d=c.cursor;switch(a){case "Ctrl-Shift-Backspace":case "Ctrl-Backspace":for(;d[f]||d.selection;)c.backspace();break;case "Shift-Backspace":case "Backspace":c.backspace();break;case "Esc":case "Tab":return void c.escapeDir(h,a,b);case "Shift-Tab":case "Shift-Esc":return void c.escapeDir(f,a,b);case "End":c.notify("move").cursor.insAtRightEnd(d.parent);break;case "Ctrl-End":c.notify("move").cursor.insAtRightEnd(c.root);break;case "Shift-End":for(;d[h];)c.selectRight();
break;case "Ctrl-Shift-End":for(;d[h]||d.parent!==c.root;)c.selectRight();break;case "Home":c.notify("move").cursor.insAtLeftEnd(d.parent);break;case "Ctrl-Home":c.notify("move").cursor.insAtLeftEnd(c.root);break;case "Shift-Home":for(;d[f];)c.selectLeft();break;case "Ctrl-Shift-Home":for(;d[f]||d.parent!==c.root;)c.selectLeft();break;case "Left":c.moveLeft();break;case "Shift-Left":c.selectLeft();break;case "Ctrl-Left":break;case "Right":c.moveRight();break;case "Shift-Right":c.selectRight();break;
case "Ctrl-Right":break;case "Up":c.moveUp();break;case "Down":c.moveDown();break;case "Shift-Up":if(d[f])for(;d[f];)c.selectLeft();else c.selectLeft();case "Shift-Down":if(d[h])for(;d[h];)c.selectRight();else c.selectRight();case "Ctrl-Up":break;case "Ctrl-Down":break;case "Ctrl-Shift-Del":case "Ctrl-Del":for(;d[h]||d.selection;)c.deleteForward();break;case "Shift-Del":case "Del":c.deleteForward();break;case "Meta-A":case "Ctrl-A":for(c.notify("move").cursor.insAtRightEnd(c.root);d[f];)c.selectLeft();
break;default:return}b.preventDefault();c.scrollHoriz()};a.moveOutOf=a.moveTowards=a.deleteOutOf=a.deleteTowards=a.unselectInto=a.selectOutOf=a.selectTowards=function(){w("overridden or never called on this node")}});K.open(function(a){function e(a,c){var d=a.notify("upDown").cursor,l=c+"Into",g=c+"OutOf";return d[h][l]?d.insAtLeftEnd(d[h][l]):d[f][l]?d.insAtRightEnd(d[f][l]):d.parent.bubble(function(a){var b=a[g];return b&&("function"==typeof b&&(b=a[g](d)),b instanceof A&&d.jumpUpDown(a,b),!0!==
b)?!1:void 0}),a}this.onNotify(function(a){"move"!==a&&"upDown"!==a||this.show().clearSelection()});a.escapeDir=function(a,c,d){H(a);c=this.cursor;return c.selection?(a===h&&this.moveRight(),a===f&&this.moveLeft(),d.preventDefault()):(c.parent!==this.root&&d.preventDefault(),c.parent!==this.root?(c.parent.moveOutOf(a,c),this.notify("move")):void 0)};Y.leftRightIntoCmdGoes=function(a){if(a&&"up"!==a&&"down"!==a)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+a+'"';return a};a.moveDir=
function(a){H(a);var c=this.cursor,d=c.options.leftRightIntoCmdGoes;return c.selection?c.insDirOf(a,c.selection.ends[a]):c[a]?c[a].moveTowards(a,c,d):c.parent.moveOutOf(a,c,d),this.notify("move")};a.moveLeft=function(){return this.moveDir(f)};a.moveRight=function(){return this.moveDir(h)};a.moveUp=function(){return e(this,"up")};a.moveDown=function(){return e(this,"down")};this.onNotify(function(a){"upDown"!==a&&(this.upDownCache={})});this.onNotify(function(a){"edit"===a&&this.show().deleteSelection()});
a.deleteDir=function(a){var c,d;return H(a),c=this.cursor,d=c.selection,this.notify("edit"),d||(c[a]?c[a].deleteTowards(a,c):c.parent.deleteOutOf(a,c)),c[f].siblingDeleted&&c[f].siblingDeleted(c.options,h),c[h].siblingDeleted&&c[h].siblingDeleted(c.options,f),c.parent.bubble("reflow"),this};a.backspace=function(){return this.deleteDir(f)};a.deleteForward=function(){return this.deleteDir(h)};this.onNotify(function(a){"select"!==a&&this.endSelection()});a.selectDir=function(a){var c,d=this.notify("select").cursor,
f=d.selection;H(a);d.anticursor||d.startSelection();(c=d[a])?f&&f.ends[a]===c&&d.anticursor[-a]!==c?c.unselectInto(a,d):c.selectTowards(a,d):d.parent.selectOutOf(a,d);d.clearSelection();d.select()||d.show()};a.selectLeft=function(){return this.selectDir(f)};a.selectRight=function(){return this.selectDir(h)}});F=function(){function d(a){var b,c=a[0]||B();for(b=1;b<a.length;b+=1)a[b].children().adopt(c,c.ends[h],0);return c}var f=m.string,b=m.regex,c=m.any,p=m.optWhitespace,e=m.succeed,v=m.fail,k=m.letter.map(function(a){return J(a)}),
ca=b(/^[^${}\\_^]/).map(function(a){return g(a)}),b=b(/^[^\\a-eg-zA-Z]/).or(f("\\").then(b(/^[a-z]+/i).or(b(/^\s+/).result(" ")).or(c))).then(function(b){var c=a[b];return c?c(b).parser():v("unknown command: \\"+b)}).or(k).or(ca),c=f("{").then(function(){return Z}).skip(f("}")),b=p.then(c.or(b.map(function(a){var b=B();return a.adopt(b,0,0),b}))),Z=b.many().map(d).skip(p),f=f("[").then(b.then(function(a){return"]"!==a.join("latex")?e(a):v()}).many().map(d).skip(p)).skip(f("]")),p=Z;return p.block=
b,p.optBlock=f,p}();K.open(function(a,e){a.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")};a.writeLatex=function(a){var c,d=this.notify("edit").cursor,e=m.all;a=F.skip(m.eof).or(e.result(!1)).parse(a);return a&&!a.isEmpty()&&(a.children().adopt(d.parent,d[f],d[h]),c=a.jQize(),c.insertBefore(d.jQ),d[f]=a.ends[h],a.finalizeInsert(d.options,d),a.ends[h][h].siblingCreated&&a.ends[h][h].siblingCreated(d.options,f),a.ends[f][f].siblingCreated&&a.ends[f][f].siblingCreated(d.options,
h),d.parent.bubble("reflow")),this};a.renderLatexMath=function(a){var c,d=this.root,e=this.cursor,l=m.all,l=F.skip(m.eof).or(l.result(!1)).parse(a);d.eachChild("postOrder","dispose");d.ends[f]=d.ends[h]=0;l&&l.children().adopt(d,0,0);a=d.jQ;l?(c=l.join("html"),a.html(c),d.jQize(a.children()),d.finalizeInsert(e.options)):a.empty();delete e.selection;e.insAtRightEnd(d)};a.renderLatexText=function(a){var c,d,e,l,k,ca,Z,n,q=this.root,r=this.cursor;if(q.jQ.children().slice(1).remove(),q.eachChild("postOrder",
"dispose"),q.ends[f]=q.ends[h]=0,delete r.selection,r.show().insAtRightEnd(q),c=m.regex,d=m.string,e=m.eof,l=m.all,k=d("$").then(F).skip(d("$").or(e)).map(function(a){var b,c=ma(r);return c.createBlocks(),b=c.ends[f],a.children().adopt(b,0,0),c}),ca=d("\\$").result("$"),Z=ca.or(c(/^[^$]/)).map(g),n=k.or(Z).many(),a=n.skip(e).or(l.result(!1)).parse(a)){for(c=0;c<a.length;c+=1)a[c].adopt(q,q.ends[h],0);q.jQize().appendTo(q.jQ);q.finalizeInsert(r.options)}}});K.open(function(a){M.p.ignoreNextMousedown=
C;a.delegateMouseEvents=function(){var a=this.root.jQ;this.container.bind("mousedown.mathquill",function(b){function c(a){e=t(a.target)}function d(a){k.anticursor||k.startSelection();g.seek(e,a.pageX,a.pageY).cursor.select();e=void 0}function f(a){k.blink=n;k.selection||(g.editable?k.show():m.detach());h.unbind("mousemove",c);t(a.target.ownerDocument).unbind("mousemove",d).unbind("mouseup",f)}var e,h=t(b.target).closest(".mq-root-block"),g=A.byId[h.attr(N)||a.attr(N)].controller,k=g.cursor,n=k.blink,
m=g.textareaSpan,r=g.textarea;k.options.ignoreNextMousedown(b)||(k.options.ignoreNextMousedown=C,g.blurred&&(g.editable||h.prepend(m),r.focus()),b.preventDefault(),b.target.unselectable=!0,k.blink=C,g.seek(t(b.target),b.pageX,b.pageY).cursor.startSelection(),h.mousemove(c),t(b.target.ownerDocument).mousemove(d).mouseup(f))})}});K.open(function(a){a.seek=function(a,b,c){var d,f,e;c=this.notify("select").cursor;return a&&(d=a.attr(N)||a.attr("mathquill-command-id"),d||(f=a.parent(),d=f.attr(N)||f.attr("mathquill-command-id"))),
e=d?A.byId[d]:this.root,w("nodeId is the id of some Node that exists",e),c.clearSelection().show(),e.seek(b,c),this.scrollHoriz(),this}});K.open(function(a){a.scrollHoriz=function(){var a,b,c,d=this.cursor,e=d.selection,g=this.root.jQ[0].getBoundingClientRect();if(e)if(b=e.jQ[0].getBoundingClientRect(),a=b.left-(g.left+20),c=b.right-(g.right-20),e.ends[f]===d[h])if(0>a)b=a;else{if(!(0<c))return;b=b.left-c<g.left+20?a:c}else if(0<c)b=c;else{if(!(0>a))return;b=b.right-a>g.right-20?c:a}else if(a=d.jQ[0].getBoundingClientRect().left,
a>g.right-20)b=a-(g.right-20);else{if(!(a<g.left+20))return;b=a-(g.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+b},100)}});K.open(function(a){M.p.substituteTextarea=function(){return t("<textarea>")[0]};a.createTextarea=function(){var a,b=this.textareaSpan=t('<span class="mq-textarea"></span>'),c=this.API.__options.substituteTextarea();if(!c.nodeType)throw"substituteTextarea() must return a DOM element, got "+c;c=this.textarea=t(c).appendTo(b);a=this;a.cursor.selectionChanged=function(){a.selectionChanged()};
a.container.bind("copy",function(){a.setTextareaSelection()})};a.selectionChanged=function(){var a=this;pa(a.container[0]);void 0===a.textareaSelectionTimeout&&(a.textareaSelectionTimeout=setTimeout(function(){a.setTextareaSelection()}))};a.setTextareaSelection=function(){this.textareaSelectionTimeout=void 0;var a="";this.cursor.selection&&(a=this.cursor.selection.join("latex"),this.API.__options.statelessClipboard&&(a="$"+a+"$"));this.selectFn(a)};a.staticMathTextareaEvents=function(){function a(){e.detach();
b.blurred=!0}var b=this,c=(b.root,b.cursor),d=b.textarea,e=b.textareaSpan;this.container.prepend('<span class="mq-selectable">$'+b.exportLatex()+"$</span>");b.blurred=!0;d.bind("cut paste",!1).focus(function(){b.blurred=!1}).blur(function(){c.selection&&c.selection.clear();setTimeout(a)});b.selectFn=function(a){d.val(a);a&&d.select()}};a.editablesTextareaEvents=function(){var a=this,b=(a.root,a.cursor),c=a.textareaSpan,d=va(a.textarea,this);this.selectFn=function(a){d.select(a)};this.container.prepend(c).on("cut",
function(c){b.selection&&setTimeout(function(){a.notify("edit");b.parent.bubble("reflow")})});this.focusBlurEvents()};a.typedText=function(a){if("\n"===a)return this.handle("enter");var b=this.notify().cursor;b.parent.write(b,a);this.scrollHoriz()};a.paste=function(a){this.API.__options.statelessClipboard&&(a="$"===a.slice(0,1)&&"$"===a.slice(-1)?a.slice(1,-1):"\\text{"+a+"}");this.writeLatex(a).cursor.show()}});ka=k(A,function(a,e){a.finalizeInsert=function(a,c){this.postOrder("finalizeTree",a);
this.postOrder("contactWeld",c);this.postOrder("blur");this.postOrder("reflow");this[h].siblingCreated&&this[h].siblingCreated(a,f);this[f].siblingCreated&&this[f].siblingCreated(a,h);this.bubble("reflow")}});u=k(ka,function(a,e){a.init=function(a,c,d){e.init.call(this);this.ctrlSeq||(this.ctrlSeq=a);c&&(this.htmlTemplate=c);d&&(this.textTemplate=d)};a.replaces=function(a){a.disown();this.replacedFragment=a};a.isEmpty=function(){return this.foldChildren(!0,function(a,c){return a&&c.isEmpty()})};a.parser=
function(){var a=this;return F.block.times(a.numBlocks()).map(function(c){a.blocks=c;for(var d=0;d<c.length;d+=1)c[d].adopt(a,a.ends[h],0);return a})};a.createLeftOf=function(a){var c=this.replacedFragment;this.createBlocks();e.createLeftOf.call(this,a);c&&(c.adopt(this.ends[f],0,0),c.jQ.appendTo(this.ends[f].jQ));this.finalizeInsert(a.options);this.placeCursor(a)};a.createBlocks=function(){var a,c,d=this.numBlocks(),e=this.blocks=Array(d);for(a=0;d>a;a+=1)c=e[a]=B(),c.adopt(this,this.ends[h],0)};
a.placeCursor=function(a){a.insAtRightEnd(this.foldChildren(this.ends[f],function(a,b){return a.isEmpty()?a:b}))};a.moveTowards=function(a,c,d){c.insAtDirEnd(-a,d&&this[d+"Into"]||this.ends[-a])};a.deleteTowards=function(a,c){this.moveTowards(a,c,null)};a.selectTowards=function(a,c){c[-a]=this;c[a]=this[a]};a.selectChildren=function(){return Da(this,this)};a.unselectInto=function(a,c){c.insAtDirEnd(-a,c.anticursor.ancestors[this.id])};a.seek=function(a,c){function d(a){var b={};return b[f]=a.jQ.offset().left,
b[h]=b[f]+a.jQ.outerWidth(),b}var e,l=this,g=d(l);return a<g[f]?c.insLeftOf(l):a>g[h]?c.insRightOf(l):(e=g[f],void l.eachChild(function(k){var m=d(k);return a<m[f]?(a-e<m[f]-a?k[f]?c.insAtRightEnd(k[f]):c.insLeftOf(l):c.insAtLeftEnd(k),!1):a>m[h]?void(k[h]?e=m[h]:g[h]-a<a-m[h]?c.insRightOf(l):c.insAtRightEnd(k)):(k.seek(a,c),!1)}))};a.numBlocks=function(){var a=this.htmlTemplate.match(/&\d+/g);return a?a.length:0};a.html=function(){var a,c,d,e=this.blocks,f=" mathquill-command-id="+this.id,l=this.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);
w("no unmatched angle brackets",l.join("")===this.htmlTemplate);a=0;for(c=l[0];c;a+=1,c=l[a])if("/>"===c.slice(-2))l[a]=c.slice(0,-2)+f+"/>";else if("<"===c.charAt(0)){w("not an unmatched top-level close tag","/"!==c.charAt(1));l[a]=c.slice(0,-1)+f+">";d=1;do a+=1,c=l[a],w("no missing close tags",c),"</"===c.slice(0,2)?--d:"<"===c.charAt(0)&&"/>"!==c.slice(-2)&&(d+=1);while(0<d)}return l.join("").replace(/>&(\d+)/g,function(a,b){return" mathquill-block-id="+e[b].id+">"+e[b].join("html")})};a.latex=
function(){return this.foldChildren(this.ctrlSeq,function(a,c){return a+"{"+(c.latex()||" ")+"}"})};a.textTemplate=[""];a.text=function(){var a=this,c=0;return a.foldChildren(a.textTemplate[c],function(d,e){c+=1;var f=e.text();return d&&"("===a.textTemplate[c]&&"("===f[0]&&")"===f.slice(-1)?d+f.slice(1,-1)+a.textTemplate[c]:d+e.text()+(a.textTemplate[c]||"")})}});D=k(u,function(a,e){a.init=function(a,c,d){d||(d=a&&1<a.length?a.slice(1):a);e.init.call(this,a,c,[d])};a.parser=function(){return m.succeed(this)};
a.numBlocks=function(){return 0};a.replaces=function(a){a.remove()};a.createBlocks=C;a.moveTowards=function(a,c){c.jQ.insDirOf(a,this.jQ);c[-a]=this;c[a]=this[a]};a.deleteTowards=function(a,c){c[a]=this.remove()[a]};a.seek=function(a,c){a-this.jQ.offset().left<this.jQ.outerWidth()/2?c.insLeftOf(this):c.insRightOf(this)};a.latex=function(){return this.ctrlSeq};a.text=function(){return this.textTemplate};a.placeCursor=C;a.isEmpty=function(){return!0}});g=k(D,function(a,e){a.init=function(a,c){e.init.call(this,
a,"<span>"+(c||a)+"</span>")}});n=k(D,function(a,e){a.init=function(a,c,d){e.init.call(this,a,'<span class="mq-binary-operator">'+c+"</span>",d)}});B=k(ka,function(d,e){d.join=function(a){return this.foldChildren("",function(c,d){return c+d[a]()})};d.html=function(){return this.join("html")};d.latex=function(){return this.join("latex")};d.text=function(){return this.ends[f]===this.ends[h]&&0!==this.ends[f]?this.ends[f].text():this.join("text")};d.keystroke=function(a,c,d){return!d.API.__options.spaceBehavesLikeTab||
"Spacebar"!==a&&"Shift-Spacebar"!==a?e.keystroke.apply(this,arguments):(c.preventDefault(),void d.escapeDir("Shift-Spacebar"===a?f:h,a,c))};d.moveOutOf=function(a,c,d){d&&this.parent[d+"Into"]||!this[a]?c.insDirOf(a,this.parent):c.insAtDirEnd(-a,this[a])};d.selectOutOf=function(a,c){c.insDirOf(a,this.parent)};d.deleteOutOf=function(a,c){c.unwrapGramp()};d.seek=function(a,c){var d=this.ends[h];if(!d||d.jQ.offset().left+d.jQ.outerWidth()<a)return c.insAtRightEnd(this);if(a<this.ends[f].jQ.offset().left)return c.insAtLeftEnd(this);
for(;a<d.jQ.offset().left;)d=d[f];return d.seek(a,c)};d.chToCmd=function(b){var c;return b.match(/^[a-eg-zA-Z]$/)?J(b):/^\d$/.test(b)?xa(b):(c=I[b]||a[b])?c(b):g(b)};d.write=function(a,c){var d=this.chToCmd(c);a.selection&&d.replaces(a.replaceSelection());d.createLeftOf(a.show())};d.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this};d.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}});la=k(B,ra);
z.MathField=ha(k(E,function(a,e){a.init=function(a,c){a.addClass("mq-editable-field mq-math-mode");this.initRootAndEvents(la(),a,c)}}));W=k(A,function(a,e){function b(a){var b,d;return a.jQ[0].normalize(),b=a.jQ[0].firstChild,d=P(b.data),d.jQadd(b),a.children().disown(),d.adopt(a,0,0)}a.ctrlSeq="\\text";a.replaces=function(a){a instanceof G?this.replacedText=a.remove().jQ.text():"string"==typeof a&&(this.replacedText=a)};a.jQadd=function(a){e.jQadd.call(this,a);this.ends[f]&&this.ends[f].jQadd(this.jQ[0].firstChild)};
a.createLeftOf=function(a){var b;if(e.createLeftOf.call(this,a),this[h].siblingCreated&&this[h].siblingCreated(a.options,f),this[f].siblingCreated&&this[f].siblingCreated(a.options,h),this.bubble("reflow"),a.insAtRightEnd(this),this.replacedText)for(b=0;b<this.replacedText.length;b+=1)this.write(a,this.replacedText.charAt(b))};a.parser=function(){var a=this,b=m.string,d=m.regex;return m.optWhitespace.then(b("{")).then(d(/^[^}]*/)).skip(b("}")).map(function(b){return P(b).adopt(a,0,0),a})};a.textContents=
function(){return this.foldChildren("",function(a,b){return a+b.text})};a.text=function(){return'"'+this.textContents()+'"'};a.latex=function(){return"\\text{"+this.textContents()+"}"};a.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"};a.moveTowards=function(a,b){b.insAtDirEnd(-a,this)};a.moveOutOf=function(a,b){b.insDirOf(a,this)};a.unselectInto=a.moveTowards;a.selectTowards=u.prototype.selectTowards;a.deleteTowards=u.prototype.deleteTowards;
a.selectOutOf=function(a,b){b.insDirOf(a,this)};a.deleteOutOf=function(a,b){this.isEmpty()&&b.insRightOf(this)};a.write=function(a,b){var d,k;a.show().deleteSelection();"$"!==b?a[f]?a[f].appendText(b):P(b).createLeftOf(a):this.isEmpty()?(a.insRightOf(this),g("\\$","$").createLeftOf(a)):a[h]?a[f]?(d=W(),k=this.ends[f],k.disown(),k.adopt(d,0,0),a.insLeftOf(this),e.createLeftOf.call(d,a)):a.insLeftOf(this):a.insRightOf(this)};a.seek=function(a,d){var e,l,g,k,m;d.hide();e=b(this);l=this.jQ.width()/this.text.length;
l=Math.round((a-this.jQ.offset().left)/l);0>=l?d.insAtLeftEnd(this):l>=e.text.length?d.insAtRightEnd(this):d.insLeftOf(e.splitRight(l));for(g=l=(e=a-d.show().offset().left)&&0>e?f:h;d[l]&&0<e*g;)d[l].moveTowards(l,d),g=e,e=a-d.offset().left;-l*g>l*e&&d[-l].moveTowards(-l,d);d.anticursor?d.anticursor.parent===this&&(k=d[f]&&d[f].text.length,this.anticursorPosition===k?d.anticursor=L.copy(d):(this.anticursorPosition<k?(m=d[f].splitRight(this.anticursorPosition),d[f]=m):m=d[h].splitRight(this.anticursorPosition-
k),d.anticursor=L(this,m[f],m))):this.anticursorPosition=d[f]&&d[f].text.length};a.blur=function(){B.prototype.blur.call(this);b(this)};a.focus=B.prototype.focus});P=k(A,function(a,e){function b(a,b){return b.charAt(a===f?0:-1+b.length)}a.init=function(a){e.init.call(this);this.text=a};a.jQadd=function(a){this.dom=a;this.jQ=t(a)};a.jQize=function(){return this.jQadd(document.createTextNode(this.text))};a.appendText=function(a){this.text+=a;this.dom.appendData(a)};a.prependText=function(a){this.text=
a+this.text;this.dom.insertData(0,a)};a.insTextAtDirEnd=function(a,b){H(b);b===h?this.appendText(a):this.prependText(a)};a.splitRight=function(a){var b=P(this.text.slice(a)).adopt(this.parent,this,this[h]);return b.jQadd(this.dom.splitText(a)),this.text=this.text.slice(0,a),b};a.moveTowards=function(a,d){var e,f;return H(a),e=b(-a,this.text),f=this[-a],f?f.insTextAtDirEnd(e,a):P(e).createDir(-a,d),this.deleteTowards(a,d)};a.latex=function(){return this.text};a.deleteTowards=function(a,b){1<this.text.length?
a===h?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),b[a]=this[a])};a.selectTowards=function(a,d){var e,f,l,g;return H(a),e=d.anticursor,f=b(-a,this.text),e[a]===this?(l=P(f).createDir(a,d),e[a]=l,d.insDirOf(a,l)):(g=this[-a],g?g.insTextAtDirEnd(f,a):(l=P(f).createDir(-a,d),l.jQ.insDirOf(-a,d.selection.jQ)),1===this.text.length&&e[-a]===this&&(e[-a]=this[-a])),this.deleteTowards(a,
d)}});I.$=a.text=a.textnormal=a.textrm=a.textup=a.textmd=W;a.em=a.italic=a.italics=a.emph=a.textit=a.textsl=Q("\\textit","i",'class="mq-text-mode"');a.strong=a.bold=a.textbf=Q("\\textbf","b",'class="mq-text-mode"');a.sf=a.textsf=Q("\\textsf","span",'class="mq-sans-serif mq-text-mode"');a.tt=a.texttt=Q("\\texttt","span",'class="mq-monospace mq-text-mode"');a.textsc=Q("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"');a.uppercase=Q("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"');
a.lowercase=Q("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"');ma=k(u,function(a,e){a.init=function(a){e.init.call(this,"$");this.cursor=a};a.htmlTemplate='<span class="mq-math-mode">&0</span>';a.createBlocks=function(){e.createBlocks.call(this);this.ends[f].cursor=this.cursor;this.ends[f].write=function(a,c){"$"!==c?B.prototype.write.call(this,a,c):this.isEmpty()?(a.insRightOf(this.parent),this.parent.deleteTowards(dir,a),g("\\$","$").createLeftOf(a.show())):a[h]?a[f]?
B.prototype.write.call(this,a,c):a.insLeftOf(this.parent):a.insRightOf(this.parent)}};a.latex=function(){return"$"+this.ends[f].latex()+"$"}});wa=k(la,function(a,e){a.keystroke=function(a){return"Spacebar"!==a&&"Shift-Spacebar"!==a?e.keystroke.apply(this,arguments):void 0};a.write=function(a,c){if(a.show().deleteSelection(),"$"===c)ma(a).createLeftOf(a);else{var d;"<"===c?d="&lt;":">"===c&&(d="&gt;");g(c,d).createLeftOf(a)}}});z.TextField=ha(k(E,function(a){a.init=function(a){a.addClass("mq-editable-field mq-text-mode");
this.initRootAndEvents(wa(),a)};a.latex=function(a){return 0<arguments.length?(this.__controller.renderLatexText(a),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}}));a.notin=a.cong=a.equiv=a.oplus=a.otimes=k(n,function(a,e){a.init=function(a){e.init.call(this,"\\"+a+" ","&"+a+";")}});a["\u2260"]=a.ne=a.neq=e(n,"\\ne ","&ne;");a.ast=a.star=a.loast=a.lowast=e(n,"\\ast ","&lowast;");a.therefor=a.therefore=e(n,"\\therefore ","&there4;");
a.cuz=a.because=e(n,"\\because ","&#8757;");a.prop=a.propto=e(n,"\\propto ","&prop;");a["\u2248"]=a.asymp=a.approx=e(n,"\\approx ","&asymp;");a.isin=a["in"]=e(n,"\\in ","&isin;");a.ni=a.contains=e(n,"\\ni ","&ni;");a.notni=a.niton=a.notcontains=a.doesnotcontain=e(n,"\\not\\ni ","&#8716;");a.sub=a.subset=e(n,"\\subset ","&sub;");a.sup=a.supset=a.superset=e(n,"\\supset ","&sup;");a.nsub=a.notsub=a.nsubset=a.notsubset=e(n,"\\not\\subset ","&#8836;");a.nsup=a.notsup=a.nsupset=a.notsupset=a.nsuperset=
a.notsuperset=e(n,"\\not\\supset ","&#8837;");a.sube=a.subeq=a.subsete=a.subseteq=e(n,"\\subseteq ","&sube;");a.supe=a.supeq=a.supsete=a.supseteq=a.supersete=a.superseteq=e(n,"\\supseteq ","&supe;");a.nsube=a.nsubeq=a.notsube=a.notsubeq=a.nsubsete=a.nsubseteq=a.notsubsete=a.notsubseteq=e(n,"\\not\\subseteq ","&#8840;");a.nsupe=a.nsupeq=a.notsupe=a.notsupeq=a.nsupsete=a.nsupseteq=a.notsupsete=a.notsupseteq=a.nsupersete=a.nsuperseteq=a.notsupersete=a.notsuperseteq=e(n,"\\not\\supseteq ","&#8841;");
a.N=a.naturals=a.Naturals=e(g,"\\mathbb{N}","&#8469;");a.P=a.primes=a.Primes=a.projective=a.Projective=a.probability=a.Probability=e(g,"\\mathbb{P}","&#8473;");a.Z=a.integers=a.Integers=e(g,"\\mathbb{Z}","&#8484;");a.Q=a.rationals=a.Rationals=e(g,"\\mathbb{Q}","&#8474;");a.R=a.reals=a.Reals=e(g,"\\mathbb{R}","&#8477;");a.C=a.complex=a.Complex=a.complexes=a.Complexes=a.complexplane=a.Complexplane=a.ComplexPlane=e(g,"\\mathbb{C}","&#8450;");a.H=a.Hamiltonian=a.quaternions=a.Quaternions=e(g,"\\mathbb{H}",
"&#8461;");a.quad=a.emsp=e(g,"\\quad ","    ");a.qquad=e(g,"\\qquad ","        ");a.diamond=e(g,"\\diamond ","&#9671;");a.bigtriangleup=e(g,"\\bigtriangleup ","&#9651;");a.ominus=e(g,"\\ominus ","&#8854;");a.uplus=e(g,"\\uplus ","&#8846;");a.bigtriangledown=e(g,"\\bigtriangledown ","&#9661;");a.sqcap=e(g,"\\sqcap ","&#8851;");a.triangleleft=e(g,"\\triangleleft ","&#8882;");a.sqcup=e(g,"\\sqcup ","&#8852;");a.triangleright=e(g,"\\triangleright ","&#8883;");a.odot=e(g,"\\odot ","&#8857;");a.bigcirc=
e(g,"\\bigcirc ","&#9711;");a.dagger=e(g,"\\dagger ","&#0134;");a.ddagger=e(g,"\\ddagger ","&#135;");a.wr=e(g,"\\wr ","&#8768;");a.amalg=e(g,"\\amalg ","&#8720;");a.models=e(g,"\\models ","&#8872;");a.prec=e(g,"\\prec ","&#8826;");a.succ=e(g,"\\succ ","&#8827;");a.preceq=e(g,"\\preceq ","&#8828;");a.succeq=e(g,"\\succeq ","&#8829;");a.simeq=e(g,"\\simeq ","&#8771;");a.mid=e(g,"\\mid ","&#8739;");a.ll=e(g,"\\ll ","&#8810;");a.gg=e(g,"\\gg ","&#8811;");a.parallel=e(g,"\\parallel ","&#8741;");a.bowtie=
e(g,"\\bowtie ","&#8904;");a.sqsubset=e(g,"\\sqsubset ","&#8847;");a.sqsupset=e(g,"\\sqsupset ","&#8848;");a.smile=e(g,"\\smile ","&#8995;");a.sqsubseteq=e(g,"\\sqsubseteq ","&#8849;");a.sqsupseteq=e(g,"\\sqsupseteq ","&#8850;");a.doteq=e(g,"\\doteq ","&#8784;");a.frown=e(g,"\\frown ","&#8994;");a.vdash=e(g,"\\vdash ","&#8870;");a.dashv=e(g,"\\dashv ","&#8867;");a.longleftarrow=e(g,"\\longleftarrow ","&#8592;");a.longrightarrow=e(g,"\\longrightarrow ","&#8594;");a.Longleftarrow=e(g,"\\Longleftarrow ",
"&#8656;");a.Longrightarrow=e(g,"\\Longrightarrow ","&#8658;");a.longleftrightarrow=e(g,"\\longleftrightarrow ","&#8596;");a.updownarrow=e(g,"\\updownarrow ","&#8597;");a.Longleftrightarrow=e(g,"\\Longleftrightarrow ","&#8660;");a.Updownarrow=e(g,"\\Updownarrow ","&#8661;");a.mapsto=e(g,"\\mapsto ","&#8614;");a.nearrow=e(g,"\\nearrow ","&#8599;");a.hookleftarrow=e(g,"\\hookleftarrow ","&#8617;");a.hookrightarrow=e(g,"\\hookrightarrow ","&#8618;");a.searrow=e(g,"\\searrow ","&#8600;");a.leftharpoonup=
e(g,"\\leftharpoonup ","&#8636;");a.rightharpoonup=e(g,"\\rightharpoonup ","&#8640;");a.swarrow=e(g,"\\swarrow ","&#8601;");a.leftharpoondown=e(g,"\\leftharpoondown ","&#8637;");a.rightharpoondown=e(g,"\\rightharpoondown ","&#8641;");a.nwarrow=e(g,"\\nwarrow ","&#8598;");a.ldots=e(g,"\\ldots ","&#8230;");a.cdots=e(g,"\\cdots ","&#8943;");a.vdots=e(g,"\\vdots ","&#8942;");a.ddots=e(g,"\\ddots ","&#8944;");a.surd=e(g,"\\surd ","&#8730;");a.triangle=e(g,"\\triangle ","&#9653;");a.ell=e(g,"\\ell ","&#8467;");
a.top=e(g,"\\top ","&#8868;");a.flat=e(g,"\\flat ","&#9837;");a.natural=e(g,"\\natural ","&#9838;");a.sharp=e(g,"\\sharp ","&#9839;");a.wp=e(g,"\\wp ","&#8472;");a.bot=e(g,"\\bot ","&#8869;");a.clubsuit=e(g,"\\clubsuit ","&#9827;");a.diamondsuit=e(g,"\\diamondsuit ","&#9826;");a.heartsuit=e(g,"\\heartsuit ","&#9825;");a.spadesuit=e(g,"\\spadesuit ","&#9824;");a.oint=e(g,"\\oint ","&#8750;");a.bigcap=e(g,"\\bigcap ","&#8745;");a.bigcup=e(g,"\\bigcup ","&#8746;");a.bigsqcup=e(g,"\\bigsqcup ","&#8852;");
a.bigvee=e(g,"\\bigvee ","&#8744;");a.bigwedge=e(g,"\\bigwedge ","&#8743;");a.bigodot=e(g,"\\bigodot ","&#8857;");a.bigotimes=e(g,"\\bigotimes ","&#8855;");a.bigoplus=e(g,"\\bigoplus ","&#8853;");a.biguplus=e(g,"\\biguplus ","&#8846;");a.lfloor=e(g,"\\lfloor ","&#8970;");a.rfloor=e(g,"\\rfloor ","&#8971;");a.lceil=e(g,"\\lceil ","&#8968;");a.rceil=e(g,"\\rceil ","&#8969;");a.opencurlybrace=a.lbrace=e(g,"\\lbrace ","{");a.closecurlybrace=a.rbrace=e(g,"\\rbrace ","}");a["\u222b"]=a["int"]=a.integral=
e(D,"\\int ","<big>&int;</big>");a.caret=e(g,"\\text{^}","^");a.underscore=e(g,"\\_","_");a.slash=e(g,"/");a.vert=e(g,"|");a.perp=a.perpendicular=e(g,"\\perp ","&perp;");a.nabla=a.del=e(g,"\\nabla ","&nabla;");a.hbar=e(g,"\\hbar ","&#8463;");a.AA=a.Angstrom=a.angstrom=e(g,"\\text\\AA ","&#8491;");a.ring=a.circ=a.circle=e(g,"\\circ ","&#8728;");a.bull=a.bullet=e(g,"\\bullet ","&bull;");a.setminus=a.smallsetminus=e(g,"\\setminus ","&#8726;");a.not=a["\u00ac"]=a.neg=e(g,"\\neg ","&not;");a["\u2026"]=
a.dots=a.ellip=a.hellip=a.ellipsis=a.hellipsis=e(g,"\\dots ","&hellip;");a.converges=a.darr=a.dnarr=a.dnarrow=a.downarrow=e(g,"\\downarrow ","&darr;");a.dArr=a.dnArr=a.dnArrow=a.Downarrow=e(g,"\\Downarrow ","&dArr;");a.diverges=a.uarr=a.uparrow=e(g,"\\uparrow ","&uarr;");a.uArr=a.Uparrow=e(g,"\\Uparrow ","&uArr;");a.to=e(n,"\\to ","&rarr;");a.rarr=a.rightarrow=e(g,"\\rightarrow ","&rarr;");a.implies=e(n,"\\Rightarrow ","&rArr;");a.rArr=a.Rightarrow=e(g,"\\Rightarrow ","&rArr;");a.gets=e(n,"\\gets ",
"&larr;");a.larr=a.leftarrow=e(g,"\\leftarrow ","&larr;");a.impliedby=e(n,"\\Leftarrow ","&lArr;");a.lArr=a.Leftarrow=e(g,"\\Leftarrow ","&lArr;");a.harr=a.lrarr=a.leftrightarrow=e(g,"\\leftrightarrow ","&harr;");a.iff=e(n,"\\Leftrightarrow ","&hArr;");a.hArr=a.lrArr=a.Leftrightarrow=e(g,"\\Leftrightarrow ","&hArr;");a.Re=a.Real=a.real=e(g,"\\Re ","&real;");a.Im=a.imag=a.image=a.imagin=a.imaginary=a.Imaginary=e(g,"\\Im ","&image;");a.part=a.partial=e(g,"\\partial ","&part;");a.infty=a.infin=a.infinity=
e(g,"\\infty ","&infin;");a.alef=a.alefsym=a.aleph=a.alephsym=e(g,"\\aleph ","&alefsym;");a.xist=a.xists=a.exist=a.exists=e(g,"\\exists ","&exist;");a.and=a.land=a.wedge=e(g,"\\wedge ","&and;");a.or=a.lor=a.vee=e(g,"\\vee ","&or;");a.o=a.O=a.empty=a.emptyset=a.oslash=a.Oslash=a.nothing=a.varnothing=e(n,"\\varnothing ","&empty;");a.cup=a.union=e(n,"\\cup ","&cup;");a.cap=a.intersect=a.intersection=e(n,"\\cap ","&cap;");a.deg=a.degree=e(g,"^\\circ ","&deg;");a.ang=a.angle=e(g,"\\angle ","&ang;");xa=
k(g,function(d,e){d.createLeftOf=function(b){b.options.autoSubscriptNumerals&&b.parent!==b.parent.parent.sub&&(b[f]instanceof x&&!1!==b[f].isItalic||b[f]instanceof R&&b[f][f]instanceof x&&!1!==b[f][f].isItalic)?(a._().createLeftOf(b),e.createLeftOf.call(this,b),b.insRightOf(b.parent.parent)):e.createLeftOf.call(this,b)}});x=k(D,function(a,e){a.init=function(a,c){e.init.call(this,a,"<var>"+(c||a)+"</var>")};a.text=function(){var a=this.ctrlSeq;return!this[f]||this[f]instanceof x||this[f]instanceof
n||(a="*"+a),!this[h]||this[h]instanceof n||"^"===this[h].ctrlSeq||(a+="*"),a}});M.p.autoCommands={_maxLength:0};Y.autoCommands=function(d){var e,b,c,f;if(!/^[a-z]+(?: [a-z]+)*$/i.test(d))throw'"'+d+'" not a space-delimited list of only letters';d=d.split(" ");e={};for(c=b=0;c<d.length;c+=1){if(f=d[c],2>f.length)throw'autocommand "'+f+'" not minimum length of 2';if(a[f]===na)throw'"'+f+'" is a built-in operator name';e[f]=1;b=Ca(b,f.length)}return e._maxLength=b,e};J=k(x,function(d,e){function b(a){return a instanceof
D&&!(a instanceof n)}d.init=function(a){return e.init.call(this,this.letter=a)};d.createLeftOf=function(b){var d,g,h,k=b.options.autoCommands,m=k._maxLength;if(0<m){d=this.letter;g=b[f];for(h=1;g instanceof J&&m>h;)d=g.letter+d,g=g[f],h+=1;for(;d.length;){if(k.hasOwnProperty(d)){h=2;for(g=b[f];h<d.length;h+=1,g=g[f]);return G(g,b[f]).remove(),b[f]=g[f],a[d](d).createLeftOf(b)}d=d.slice(1)}}e.createLeftOf.apply(this,arguments)};d.italicize=function(a){return this.isItalic=a,this.jQ.toggleClass("mq-operator-name",
!a),this};d.finalizeTree=d.siblingDeleted=d.siblingCreated=function(a,b){b!==f&&this[h]instanceof J||this.autoUnItalicize(a)};d.autoUnItalicize=function(a){var d,e,g,l,k,m,n,q=a.autoOperatorNames;if(0!==q._maxLength){a=this.letter;for(d=this[f];d instanceof J;d=d[f])a=d.letter+a;for(e=this[h];e instanceof J;e=e[h])a+=e.letter;G(d[h]||this.parent.ends[f],e[f]||this.parent.ends[h]).each(function(a){a.italicize(!0).jQ.removeClass("mq-first mq-last");a.ctrlSeq=a.letter});e=0;d=d[h]||this.parent.ends[f];
a:for(;e<a.length;e+=1,d=d[h])for(g=ta(q._maxLength,a.length-e);0<g;--g)if(l=a.slice(e,e+g),q.hasOwnProperty(l)){k=0;for(m=d;g>k;k+=1,m=m[h])m.italicize(!1),n=m;k=T.hasOwnProperty(l);d.ctrlSeq=(k?"\\":"\\operatorname{")+d.ctrlSeq;n.ctrlSeq+=k?" ":"}";ya.hasOwnProperty(l)&&n[f][f][f].jQ.addClass("mq-last");b(d[f])&&d.jQ.addClass("mq-first");b(n[h])&&n.jQ.addClass("mq-last");e+=g-1;d=n;continue a}}}});T={};ya={limsup:1,liminf:1,projlim:1,injlim:1};(function(){var a,e,b=M.p.autoOperatorNames={_maxLength:9};
e="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" ");for(a=0;a<e.length;a+=1)T[e[a]]=b[e[a]]=1;e="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" ");for(a=0;a<e.length;a+=1)T[e[a]]=1;e="sin cos tan sec cosec csc cotan cot ctg".split(" ");for(a=0;a<e.length;a+=1)b[e[a]]=b["arc"+e[a]]=b[e[a]+"h"]=b["ar"+e[a]+"h"]=b["arc"+e[a]+"h"]=1})();Y.autoOperatorNames=function(a){var e,b,c,f;if(!/^[a-z]+(?: [a-z]+)*$/i.test(a))throw'"'+
a+'" not a space-delimited list of only letters';a=a.split(" ");e={};for(c=b=0;c<a.length;c+=1){if(f=a[c],2>f.length)throw'"'+f+'" not minimum length of 2';e[f]=1;b=Ca(b,f.length)}return e._maxLength=b,e};na=k(D,function(a,e){a.init=function(a){this.ctrlSeq=a};a.createLeftOf=function(a){var c,d=this.ctrlSeq;for(c=0;c<d.length;c+=1)J(d.charAt(c)).createLeftOf(a)};a.parser=function(){var a,c=this.ctrlSeq,d=B();for(a=0;a<c.length;a+=1)J(c.charAt(a)).adopt(d,d.ends[h],0);return m.succeed(d.children())}});
for(r in T)T.hasOwnProperty(r)&&(a[r]=na);a.operatorname=k(u,function(a){a.createLeftOf=C;a.numBlocks=function(){return 1};a.parser=function(){return F.block.map(function(a){return a.children()})}});a.f=k(J,function(a,e){a.init=function(){D.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')};a.italicize=function(a){return this.jQ.html("f").toggleClass("mq-f",a),e.italicize.apply(this,arguments)}});a[" "]=a.space=e(g,"\\ ","&nbsp;");a["'"]=a.prime=e(g,"'","&prime;");a.backslash=e(g,"\\backslash ",
"\\");I["\\"]||(I["\\"]=a.backslash);a.$=e(g,"\\$","$");r=k(D,function(a,e){a.init=function(a,c){e.init.call(this,a,'<span class="mq-nonSymbola">'+(c||a)+"</span>")}});a["@"]=r;a["&"]=e(r,"\\&","&amp;");a["%"]=e(r,"\\%","%");a.alpha=a.beta=a.gamma=a.delta=a.zeta=a.eta=a.theta=a.iota=a.kappa=a.mu=a.nu=a.xi=a.rho=a.sigma=a.tau=a.chi=a.psi=a.omega=k(x,function(a,e){a.init=function(a){e.init.call(this,"\\"+a+" ","&"+a+";")}});a.phi=e(x,"\\phi ","&#981;");a.phiv=a.varphi=e(x,"\\varphi ","&phi;");a.epsilon=
e(x,"\\epsilon ","&#1013;");a.epsiv=a.varepsilon=e(x,"\\varepsilon ","&epsilon;");a.piv=a.varpi=e(x,"\\varpi ","&piv;");a.sigmaf=a.sigmav=a.varsigma=e(x,"\\varsigma ","&sigmaf;");a.thetav=a.vartheta=a.thetasym=e(x,"\\vartheta ","&thetasym;");a.upsilon=a.upsi=e(x,"\\upsilon ","&upsilon;");a.gammad=a.Gammad=a.digamma=e(x,"\\digamma ","&#989;");a.kappav=a.varkappa=e(x,"\\varkappa ","&#1008;");a.rhov=a.varrho=e(x,"\\varrho ","&#1009;");a.pi=a["\u03c0"]=e(r,"\\pi ","&pi;");a.lambda=e(r,"\\lambda ","&lambda;");
a.Upsilon=a.Upsi=a.upsih=a.Upsih=e(D,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>');a.Gamma=a.Delta=a.Theta=a.Lambda=a.Xi=a.Pi=a.Sigma=a.Phi=a.Psi=a.Omega=a.forall=k(g,function(a,e){a.init=function(a){e.init.call(this,"\\"+a+" ","&"+a+";")}});r=k(u,function(a){a.init=function(a){this.latex=a};a.createLeftOf=function(a){var b=F.parse(this.latex);b.children().adopt(a.parent,a[f],a[h]);a[f]=b.ends[h];b.jQize().insertBefore(a.jQ);b.finalizeInsert(a.options,a);b.ends[h][h].siblingCreated&&
b.ends[h][h].siblingCreated(a.options,f);b.ends[f][f].siblingCreated&&b.ends[f][f].siblingCreated(a.options,h);a.parent.bubble("reflow")};a.parser=function(){var a=F.parse(this.latex).children();return m.succeed(a)}});a["\u00b9"]=e(r,"^1");a["\u00b2"]=e(r,"^2");a["\u00b3"]=e(r,"^3");a["\u00bc"]=e(r,"\\frac14");a["\u00bd"]=e(r,"\\frac12");a["\u00be"]=e(r,"\\frac34");r=k(n,function(a){a.init=g.prototype.init;a.contactWeld=a.siblingCreated=a.siblingDeleted=function(a,b){return b!==h?(this.jQ[0].className=
!this[f]||this[f]instanceof n?"":"mq-binary-operator",this):void 0}});a["+"]=e(r,"+","+");a["\u2013"]=a["-"]=e(r,"-","&minus;");a["\u00b1"]=a.pm=a.plusmn=a.plusminus=e(r,"\\pm ","&plusmn;");a.mp=a.mnplus=a.minusplus=e(r,"\\mp ","&#8723;");I["*"]=a.sdot=a.cdot=e(n,"\\cdot ","&middot;");U=k(n,function(a,e){a.init=function(a,c){this.data=a;var d=(this.strict=c)?"Strict":"";e.init.call(this,a["ctrlSeq"+d],a["html"+d],a["text"+d])};a.swap=function(a){a=(this.strict=a)?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+
a];this.jQ.html(this.data["html"+a]);this.textTemplate=[this.data["text"+a]]};a.deleteTowards=function(a,c){return a!==f||this.strict?void e.deleteTowards.apply(this,arguments):(this.swap(!0),void this.bubble("reflow"))}});r={ctrlSeq:"\\le ",html:"&le;",text:"\u2264",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"};E={ctrlSeq:"\\ge ",html:"&ge;",text:"\u2265",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};a["<"]=a.lt=e(U,r,!0);a[">"]=a.gt=e(U,E,!0);a["\u2264"]=a.le=a.leq=e(U,r,!1);a["\u2265"]=
a.ge=a.geq=e(U,E,!1);oa=k(n,function(a,e){a.init=function(){e.init.call(this,"=","=")};a.createLeftOf=function(a){return a[f]instanceof U&&a[f].strict?(a[f].swap(!1),void a[f].bubble("reflow")):void e.createLeftOf.apply(this,arguments)}});a["="]=oa;a.times=e(n,"\\times ","&times;","[x]");a["\u00f7"]=a.div=a.divide=a.divides=e(n,"\\div ","&divide;","[/]");I["~"]=a.sim=e(n,"\\sim ","~","~");pa=C;r=document.createElement("div").style;E={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};
for(y in E)if(y in r){qa=y;break}qa?X=function(a,e,b){a.css(qa,"scale("+e+","+b+")")}:"filter"in r?(pa=function(a){a.className=a.className},X=function(a,e,b){function c(){a.css("marginRight",(f.width()-1)*(e-1)/e+"px")}var f,g;e/=1+(b-1)/2;a.css("fontSize",b+"em");a.hasClass("mq-matrixed-container")||a.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');f=a.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')");c();g=
setInterval(c);t(window).load(function(){clearTimeout(g);c()})}):X=function(a,e,b){a.css("fontSize",b+"em")};y=k(u,function(a,e){a.init=function(a,c,d){e.init.call(this,a,"<"+c+" "+d+">&0</"+c+">")}});a.mathrm=e(y,"\\mathrm","span",'class="mq-roman mq-font"');a.mathit=e(y,"\\mathit","i",'class="mq-font"');a.mathbf=e(y,"\\mathbf","b",'class="mq-font"');a.mathsf=e(y,"\\mathsf","span",'class="mq-sans-serif mq-font"');a.mathtt=e(y,"\\mathtt","span",'class="mq-monospace mq-font"');a.underline=e(y,"\\underline",
"span",'class="mq-non-leaf mq-underline"');a.overline=a.bar=e(y,"\\overline","span",'class="mq-non-leaf mq-overline"');a.textcolor=k(u,function(a,e){a.setColor=function(a){this.color=a;this.htmlTemplate='<span class="mq-textcolor" style="color:'+a+'">&0</span>'};a.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"};a.parser=function(){var a=this,c=m.string,d=m.regex;return m.optWhitespace.then(c("{")).then(d(/^[#\w\s.,()%-]*/)).skip(c("}")).then(function(c){return a.setColor(c),
e.parser.call(a)})}});a["class"]=k(u,function(a,e){a.parser=function(){var a=this,c=m.string,d=m.regex;return m.optWhitespace.then(c("{")).then(d(/^[-\w\s\\\xA0-\xFF]*/)).skip(c("}")).then(function(c){return a.htmlTemplate='<span class="mq-class '+c+'">&0</span>',e.parser.call(a)})}});R=k(u,function(a,e){a.ctrlSeq="_{...}^{...}";a.createLeftOf=function(a){return a[f]||!a.options.supSubsRequireOperand?e.createLeftOf.apply(this,arguments):void 0};a.contactWeld=function(a){var c,d,e,g,l,k;for(c=f;c;c=
c===f?h:!1)if(this[c]instanceof R){for(d="sub";d;d="sub"===d?"sup":!1)e=this[d],g=this[c][d],e&&(g?e.isEmpty()?k=L(g,0,g.ends[f]):(e.jQ.children().insAtDirEnd(-c,g.jQ),l=e.children().disown(),k=L(g,l.ends[h],g.ends[f]),c===f?l.adopt(g,g.ends[h],0):l.adopt(g,0,g.ends[f])):this[c].addBlock(e.disown()),this.placeCursor=function(a,b){return function(d){d.insAtDirEnd(-c,a||b)}}(g,e));this.remove();a&&a[f]===this&&(c===h&&k?k[f]?a.insRightOf(k[f]):a.insAtLeftEnd(k.parent):a.insRightOf(this[c]));break}this.respace()};
M.p.charsThatBreakOutOfSupSub="";a.finalizeTree=function(){this.ends[f].write=function(a,c){if(a.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===c)return;var d=this.chToCmd(c);return d instanceof D?a.deleteSelection():a.clearSelection().insRightOf(this.parent),d.createLeftOf(a.show())}-1<a.options.charsThatBreakOutOfSupSub.indexOf(c)&&0!==a[f]&&a.insRightOf(this.parent);B.p.write.apply(this,arguments)}};a.moveTowards=function(a,c,d){c.options.autoSubscriptNumerals&&!this.sup?c.insDirOf(a,
this):e.moveTowards.apply(this,arguments)};a.deleteTowards=function(a,c){if(c.options.autoSubscriptNumerals&&this.sub){var d=this.sub.ends[-a];d instanceof D?d.remove():d&&d.deleteTowards(a,c.insAtDirEnd(-a,this.sub));this.sub.isEmpty()&&this.sub.deleteOutOf(-a,c.insAtLeftEnd(this.sub))}else e.deleteTowards.apply(this,arguments)};a.latex=function(){function a(b,d){var e=d&&d.latex();return d?b+(1===e.length?e:"{"+(e||" ")+"}"):""}return a("_",this.sub)+a("^",this.sup)};a.respace=a.siblingCreated=
a.siblingDeleted=function(a,c){c!==h&&this.jQ.toggleClass("mq-limit","\\int "===this[f].ctrlSeq)};a.addBlock=function(a){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=a,a.adopt(this,this.sub,0).downOutOf=this.sub,a.jQ=t('<span class="mq-sup"/>').append(a.jQ.children()).attr(N,a.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=a,a.adopt(this,0,this.sup).upOutOf=this.sup,a.jQ=t('<span class="mq-sub"></span>').append(a.jQ.children()).attr(N,a.id).appendTo(this.jQ.removeClass("mq-sup-only")),
this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(a=0;2>a;a+=1)(function(a,b,d,e){a[b].deleteOutOf=function(f,g){g.insDirOf(f,this.parent);this.isEmpty()||(g[-f]=this.ends[f],this.children().disown().withDirAdopt(f,g.parent,g[f],this.parent).jQ.insDirOf(f,this.parent.jQ));a.supsub=d;delete a[b];delete a[e+"Into"];a[d][e+"OutOf"]=ia;delete a[d].deleteOutOf;"sub"===b&&t(a.jQ.addClass("mq-sup-only")[0].lastChild).remove();this.remove()}})(this,["sub","sup"][a],["sup","sub"][a],
["down","up"][a])}});a.subscript=a._=k(R,function(a,e){a.supsub="sub";a.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>';a.textTemplate=["_"];a.finalizeTree=function(){this.downInto=this.sub=this.ends[f];this.sub.upOutOf=ia;e.finalizeTree.call(this)}});a.superscript=a.supscript=a["^"]=k(R,function(a,e){a.supsub="sup";a.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>';
a.textTemplate=["**"];a.finalizeTree=function(){this.upInto=this.sup=this.ends[h];this.sup.downOutOf=ia;e.finalizeTree.call(this)}});V=k(u,function(a,e){a.init=function(a,c){D.prototype.init.call(this,a,'<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+c+'</big><span class="mq-from"><span>&0</span></span></span>')};a.createLeftOf=function(a){e.createLeftOf.apply(this,arguments);a.options.sumStartsWithNEquals&&(J("n").createLeftOf(a),oa().createLeftOf(a))};
a.latex=function(){function a(b){return 1===b.length?b:"{"+(b||" ")+"}"}return this.ctrlSeq+"_"+a(this.ends[f].latex())+"^"+a(this.ends[h].latex())};a.parser=function(){var a,c=m.string,d=m.optWhitespace,e=m.succeed,f=F.block,g=this,k=g.blocks=[B(),B()];for(a=0;a<k.length;a+=1)k[a].adopt(g,g.ends[h],0);return d.then(c("_").or(c("^"))).then(function(a){var b=k["_"===a?0:1];return f.then(function(a){return a.children().adopt(b,b.ends[h],0),e(g)})}).many().result(g)};a.finalizeTree=function(){this.downInto=
this.ends[f];this.upInto=this.ends[h];this.ends[f].upOutOf=this.ends[h];this.ends[h].downOutOf=this.ends[f]}});a["\u2211"]=a.sum=a.summation=e(V,"\\sum ","&sum;");a["\u220f"]=a.prod=a.product=e(V,"\\prod ","&prod;");a.coprod=a.coproduct=e(V,"\\coprod ","&#8720;");y=a.frac=a.dfrac=a.cfrac=a.fraction=k(u,function(a,e){a.ctrlSeq="\\frac";a.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>';
a.textTemplate=["(","/",")"];a.finalizeTree=function(){this.upInto=this.ends[h].upOutOf=this.ends[f];this.downInto=this.ends[f].downOutOf=this.ends[h]}});za=a.over=I["/"]=k(y,function(d,e){d.createLeftOf=function(b){if(!this.replacedFragment){for(var c=b[f];c&&!(c instanceof n||c instanceof(a.text||C)||c instanceof V||"\\ "===c.ctrlSeq||/^[,;:]$/.test(c.ctrlSeq));)c=c[f];c instanceof V&&c[h]instanceof R&&(c=c[h],c[h]instanceof R&&c[h].ctrlSeq!=c.ctrlSeq&&(c=c[h]));c!==b[f]&&(this.replaces(G(c[h]||
b.parent.ends[f],b[f])),b[f]=c)}e.createLeftOf.call(this,b)}});y=a.sqrt=a["\u221a"]=k(u,function(a,e){a.ctrlSeq="\\sqrt";a.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>';a.textTemplate=["sqrt(",")"];a.parser=function(){return F.optBlock.then(function(a){return F.block.map(function(c){var d=Aa();return d.blocks=[a,c],a.adopt(d,0,0),c.adopt(d,a,0),d})}).or(e.parser.call(this))};a.reflow=function(){var a=
this.ends[h].jQ;X(a.prev(),1,a.innerHeight()/+a.css("fontSize").slice(0,-2)-.1)}});a.vec=k(u,function(a,e){a.ctrlSeq="\\vec";a.htmlTemplate='<span class="mq-non-leaf"><span class="mq-vector-prefix">&rarr;</span><span class="mq-vector-stem">&0</span></span>';a.textTemplate=["vec(",")"]});Aa=a.nthroot=k(y,function(a,e){a.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>';
a.textTemplate=["sqrt[","](",")"];a.latex=function(){return"\\sqrt["+this.ends[f].latex()+"]{"+this.ends[h].latex()+"}"}});O=k(k(u,sa),function(a,e){a.init=function(a,c,d,g,k){e.init.call(this,"\\left"+g,void 0,[c,d]);this.side=a;this.sides={};this.sides[f]={ch:c,ctrlSeq:g};this.sides[h]={ch:d,ctrlSeq:k}};a.numBlocks=function(){return 1};a.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===h?" mq-ghost":"")+'">'+this.sides[f].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+
(this.side===f?" mq-ghost":"")+'">'+this.sides[h].ch+"</span></span>",e.html.call(this)};a.latex=function(){return"\\left"+this.sides[f].ctrlSeq+this.ends[f].latex()+"\\right"+this.sides[h].ctrlSeq};a.oppBrack=function(a,c,d){return c instanceof O&&c.side&&c.side!==-d&&("|"===this.sides[this.side].ch||c.side===-this.side)&&(!a.restrictMismatchedBrackets||S[this.sides[this.side].ch]===c.sides[c.side].ch||{"(":"]","[":")"}[this.sides[f].ch]===c.sides[h].ch)&&c};a.closeOpposing=function(a){a.side=0;
a.sides[this.side]=this.sides[this.side];a.delimjQs.eq(this.side===f?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)};a.createLeftOf=function(a){var c,d,g;this.replacedFragment||(c=a.options,d=this.oppBrack(c,a[f],f)||this.oppBrack(c,a[h],h)||this.oppBrack(c,a.parent.parent));d?(g=this.side=-d.side,this.closeOpposing(d),d===a.parent.parent&&a[g]&&(G(a[g],a.parent.ends[g],-g).disown().withDirAdopt(-g,d.parent,d,d[g]).jQ.insDirOf(g,d.jQ),d.bubble("reflow"))):(d=this,g=d.side,d.replacedFragment?
d.side=0:a[-g]&&(d.replaces(G(a[-g],a.parent.ends[-g],g)),a[-g]=0),e.createLeftOf.call(d,a));g===f?a.insAtLeftEnd(d.ends[f]):a.insRightOf(d)};a.placeCursor=C;a.unwrap=function(){this.ends[f].children().disown().adopt(this.parent,this,this[h]).jQ.insertAfter(this.jQ);this.remove()};a.deleteSide=function(a,c,d){var e,g,h=this.parent,k=this[a],l=h.ends[a];return a===this.side||0===this.side&&-1===a?(this.unwrap(),void(k?d.insDirOf(-a,k):d.insAtDirEnd(a,h))):(e=d.options,this.side=-a,void(this.oppBrack(e,
this.ends[f].ends[this.side],a)?(this.closeOpposing(this.ends[f].ends[this.side]),g=this.ends[f].ends[a],this.unwrap(),g.siblingCreated&&g.siblingCreated(d.options,a),k?d.insDirOf(-a,k):d.insAtDirEnd(a,h)):(this.oppBrack(e,this.parent.parent,a)?(this.parent.parent.closeOpposing(this),this.parent.parent.unwrap()):(this.sides[a]={ch:S[this.sides[this.side].ch],ctrlSeq:S[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(a===f?0:1).addClass("mq-ghost").html(this.sides[a].ch)),k?
(g=this.ends[f].ends[a],G(k,l,-a).disown().withDirAdopt(-a,this.ends[f],g,0).jQ.insAtDirEnd(a,this.ends[f].jQ.removeClass("mq-empty")),g.siblingCreated&&g.siblingCreated(d.options,a),d.insDirOf(-a,k)):c?d.insDirOf(a,this):d.insAtDirEnd(a,this.ends[f]))))};a.deleteTowards=function(a,c){this.deleteSide(-a,!1,c)};a.finalizeTree=function(){this.ends[f].deleteOutOf=function(a,c){this.parent.deleteSide(a,!0,c)};this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===f?1:0).removeClass("mq-ghost");
this.side=0}};a.siblingCreated=function(a,c){c===-this.side&&this.finalizeTree()}});S={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"};ja("(");ja("[");ja("{","\\{");a.langle=e(O,f,"&lang;","&rang;","\\langle ","\\rangle ");a.rangle=e(O,h,"&lang;","&rang;","\\langle ","\\rangle ");I["|"]=e(O,f,"|","|","|","|");a.left=k(u,function(a){a.parser=function(){var a=m.regex,b=m.string,c=(m.succeed,
m.optWhitespace);return c.then(a(/^(?:[([|]|\\\{)/)).then(function(d){var e="\\"===d.charAt(0)?d.slice(1):d;return F.then(function(f){return b("\\right").skip(c).then(a(/^(?:[\])|]|\\\})/)).map(function(a){var b="\\"===a.charAt(0)?a.slice(1):a;a=O(0,e,b,d,a);return a.blocks=[f],f.adopt(a,0,0),a})})})}});a.right=k(u,function(a){a.parser=function(){return m.fail("unmatched \\right")}});y=a.binom=a.binomial=k(k(u,sa),function(a,e){a.ctrlSeq="\\binom";a.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>';
a.textTemplate=["choose(",",",")"]});a.choose=k(y,function(a){a.createLeftOf=za.prototype.createLeftOf});Ba=k(z.MathField,function(a){a.init=function(a,b){ra(a);this.__options=M();var c=K(this,a,b);c.editable=!0;c.createTextarea();c.editablesTextareaEvents();c.cursor.insAtRightEnd(a)}});a.MathQuillMathField=k(u,function(a,e){a.ctrlSeq="\\MathQuillMathField";a.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>';a.parser=function(){var a=this,c=m.string,d=m.regex,
f=m.succeed;return c("[").then(d(/^[a-z][a-z0-9]*/i)).skip(c("]")).map(function(c){a.name=c}).or(f()).then(e.parser.call(a))};a.finalizeTree=function(){Ba(this.ends[f],this.jQ)};a.registerInnerField=function(a){a.push(a[this.name]=this.ends[f].controller.API)};a.latex=function(){return this.ends[f].latex()};a.text=function(){return this.ends[f].text()}});I["\\"]=k(u,function(d,e){d.ctrlSeq="\\";d.replaces=function(a){this._replacedFragment=a.disown();this.isEmpty=function(){return!1}};d.htmlTemplate=
'<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>';d.textTemplate=["\\"];d.createBlocks=function(){e.createBlocks.call(this);this.ends[f].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this};this.ends[f].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this};this.ends[f].write=function(a,c){a.show().deleteSelection();c.match(/[a-z]/i)?
g(c).createLeftOf(a):(this.parent.renderCommand(a),"\\"===c&&this.isEmpty()||this.parent.parent.write(a,c))};this.ends[f].keystroke=function(a,c,d){return"Tab"===a||"Enter"===a||"Spacebar"===a?(this.parent.renderCommand(d.cursor),void c.preventDefault()):e.keystroke.apply(this,arguments)}};d.createLeftOf=function(a){if(e.createLeftOf.call(this,a),this._replacedFragment){var c=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(a){return t(a.target=
c).trigger(a),!1}).insertBefore(this.jQ).add(this.jQ)}};d.latex=function(){return"\\"+this.ends[f].latex()+" "};d.renderCommand=function(b){var c,d;this.jQ=this.jQ.last();this.remove();this[h]?b.insLeftOf(this[h]):b.insAtRightEnd(this.parent);(c=this.ends[f].latex())||(c=" ");(d=a[c])?(d=d(c),this._replacedFragment&&d.replaces(this._replacedFragment),d.createLeftOf(b)):(d=W(),d.replaces(c),d.createLeftOf(b),b.insRightOf(d),this._replacedFragment&&this._replacedFragment.remove())}})}();